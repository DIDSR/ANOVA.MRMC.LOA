---
title: Simulation Studies in "Three-way Mixed Effect ANOVA to Estimate MRMC Limits
  of Agreement"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(iMRMC)
library(ANOVA.MRMC.LOA)
```

In this R Markdown file, we provide the code for generating the plots in the Result section of the manuscript.Two simulation studies were conducted to validate both the simulation and limits of agreement variance estimates.

## Verify the simulation is consistent with the derived theoretical values

By simulating individual WRBM and BRBM differences independently from the model, we can calculate Monte Carlo estimates of the variances of WRBM and BRBM differences and compare them to the theoretical values derived from the model. There were two sets of parameters in this experiment. One set of parameters fixed the case related parameters $σ_C^2=σ_{τC}^2=1$ and allowed the reader related parameter $α_R (=α_{τR})$ to range from 2 to 20. The other set of parameters fixed the reader related parameters $α_R=α_{τR}=10$ and allowed the case related parameter $σ_C^2 (=σ_{τC}^2)$ to range from 0.1 to 2, incrementing by 0.1. In both parameter sets, $β_R=β_{τR}=1$, so that the reader variability is only affected by α_R. We simulated 100,000 trials with each trial having 4 measurements from 2 readers for a single case under 2 modalities. The Monte Carlo estimates of the variances are the sample variances of the 100,000 independent WRBM and BRBM differences. The relative bias between the Monte Carlo estimates $\tilde{V}_{WR}^{12},\tilde{V}_{BR}^{12}$ and the derived theoretical values $V_{WR}^{12},V_{BR}^{12}$ are defined as
\[
relative\_bias(\tilde{V}_{WR}^{12})=\frac{\tilde{V}_{WR}^{12}-V_{WR}^{12}}{V_{WR}^{12}}\\
relative\_bias(\tilde{V}_{BR}^{12})=\frac{\tilde{V}_{BR}^{12}-V_{BR}^{12}}{V_{BR}^{12}}\
\]

```{r 
}
summary(cars)
```

## Validate and characterize the MRMC limits of agreement estimates

In this experiment, we compared the variance estimates of WRBM and BRBM differences by ANOVA to the derived theoretical values. We denote the variance estimates of WRBM and BRBM differences for the trial t by V ̂_(WR,t)^12and V ̂_(BR,t)^12  and we assess the estimates in terms of relative bias and coefficient of variation:
	relative_bias(V ̂_WR^12 )=(□(1/T) ∑_t▒V ̂_(WR,t)^12 -V_WR^12)/(V_WR^12 )  ,	(20)
	CV(V ̂_WR^12 )=SD(V ̂_(WR,t)^12 )/(V_WR^12 )  .	(21)
where SD() denotes the sample standard deviation across T=1000 Monte Carlo trials.
We tested on the following three sets of parameters:
	Different number of readers J=3,4,…,10,K=100, α_R=10, σ_C^2=1
Different number of cases  K=50,60,…,150, J=5, α_R=10, σ_C^2=1
Different reader and case variabilities  (α_R,σ_C^2)∈{3,4,6,11,21}×{0.1,0.2,0.4,□(2⁄3),1}, J=5, K=100
The range of α_R and σ_C^2 in the third set was selected based on the weights of parameters in theoretical value V_BR^12. When β_R=β_τR=1, α_R=α_τR, σ_C^2=σ_τC^2,
	V_BR^12=(2β_R)/(α_R-1)+2σ_τC^2+(2β_τR)/(α_τR-1)=4/(α_R-1)+2σ_C^2  	(22)
To make sure both α_R and σ_C^2  range from low variability to high variability and contribute to V_BRBM at the similar level, we selected the parameters so that 4⁄(〖(α〗_R-1)) and 2σ_C^2 can be at 5 different levels: 0.2,0.4,0.8, 4⁄3, 2. Hence, the theoretical value V_BR^12 ranged from 0.4 to 4.

